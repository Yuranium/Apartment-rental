<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Аренда недвижимости</title>
    <link th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css}" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body th:object="${currentUser}" class="container">
<h1>RENTAP</h1><hr>

<span th:if="${currentUser == null}">
    <h2>Привет, пользователь</h2>
    <a href="/registration">Зарегистрироваться</a>
    <a href="/login">Войти</a>
</span>
<span th:if="${currentUser != null}">
    <a href="/logout">Выйти из аккаунта</a>
</span>
<span>
    <a href="/apartments/all">Все доступные апартаменты</a>
    <a th:if="${currentUser != null}" th:text="${'Посмотреть собственные платежи'}"
       th:href="@{/payment/user/{id}(id=${currentUser.id})}">Посмотреть собственные платежи</a>
    <a th:if="${roles != null && roles.contains('ROLE_ADMIN')}" th:text="${'Пользователи'}" href="/admin/all-users"></a>
</span>

<h2 th:if="${currentUser != null}" th:text="${'Привет, ' + currentUser.email.split('@')[0]}">
</h2><br>
<h2>Найти апартаменты сейчас</h2>
<hr>
<form th:action="@{/apartments/search}" th:method="POST">
    <h2>Аренда недвижимости</h2>

    <div class="form-group" style="position: relative;">
        <label for="name">Название</label>
        <input type="text" id="name" name="name">
        <div id="suggestions" class="autocomplete-items"></div>
    </div>

    <div class="form-group">
        <label for="roomCount">Количество комнат:</label>
        <select id="roomCount" name="roomCount">
            <option value="">Выберите количество комнат</option>
            <option value="1">1 комната</option>
            <option value="2">2 комнаты</option>
            <option value="3">3 комнаты</option>
            <option value="4">4 комнаты</option>
            <option value="5">5 и более комнат</option>
        </select>
    </div>

    <div class="form-group">
        <label for="dailyPrice">Цена за день: (Верхний интервал)</label>
        <input type="number" id="dailyPrice" name="dailyPrice" min="0" step="0.01">
    </div>

    <div class="form-group">
        <label for="apartmentType">Тип недвижимости:</label>
        <select id="apartmentType" name="apartmentType">
            <option value="">Выберите тип</option>
            <option value="FLAT">Квартира</option>
            <option value="HOTEL">Отель</option>
            <option value="HOUSE">Дом</option>
            <option value="OFFICE">Офис</option>
        </select>
    </div>

        <button type="submit" class="btn btn-primary">Найти</button>
    </form>
<hr>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const inputField = document.getElementById("name");
        const suggestionsBox = document.getElementById("suggestions");

        function showSuggestions(suggestions) {
            suggestionsBox.innerHTML = "";
            const list = document.createElement("ul");

            suggestions.forEach(suggestion => {
                const listItem = document.createElement("li");
                listItem.textContent = suggestion;

                listItem.addEventListener("click", function() {
                    inputField.value = suggestion;
                    suggestionsBox.innerHTML = "";
                });

                list.appendChild(listItem);
            });

            suggestionsBox.appendChild(list);
        }

        inputField.addEventListener("input", function() {
            const query = inputField.value;
            if (query.length < 2) {
                suggestionsBox.innerHTML = "";
                return;
            }
            fetch(`http://localhost:8080/apartments/api/autocomplete?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        showSuggestions(data);
                    } else {
                        suggestionsBox.innerHTML = "<p>Нет предложений</p>";
                    }
                })
                .catch(error => {
                    console.error("Ошибка автодополнения:", error);
                    suggestionsBox.innerHTML = "<p>Ошибка загрузки данных</p>";
                });
        });

        document.addEventListener("click", function(event) {
            if (event.target !== inputField) {
                suggestionsBox.innerHTML = "";
            }
        });
    });
</script>
</body>
</html>